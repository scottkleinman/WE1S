{% extends "layout.html" %}

{% block styles %}
    <style type="text/css">
        .padded-row {
            padding: 5px;
            margin: 5px;
        }
    </style>
{% endblock %}

{% block headscripts %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.10.12/datatables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.10.12/datatables.min.js"></script>
<script>
$(document).ready(function() {
    $(document).on('click', '#delete', function() {
        let that = this;
        bootbox.confirm({ 
            size: 'small',
            message: "Are you sure you wish to delete this publication?", 
            callback: function(result) {
                if (result) {
                    // Confirmed. Delete the publication
                    let delete_post = {_id:$(that).closest('tr').attr('id')};
                    $.post('/display/publications/delete', delete_post, function(){
                        location.reload();
                    });
                }
            }
        });
    });

    $(document).on('click', '#export', function() {
        // Kind of hacky, but theres no clean way to start a download from a post
        let url = '/display/publications/export/';
        var form = $('<form></form>').attr('action', url).attr('method', 'post');
        form.append($("<input></input>").attr('type', 'hidden').attr('name', '_id').attr('value', $(this).closest('tr').attr('id')));
        form.appendTo('body').submit().remove();
    });

    $('#publicationTable').dataTable({
        "columnDefs" : [{
            orderable: false,
            targets: -1 // The last column
        }]
    });

});
</script>
{% endblock %}

{% block content %}
    <div class="jumbotron" style="padding: 10px;">
    <div class="row padded-row">
    <div class="col-md-12">
        <h2>Publications</h2>
        <br>
        <table id="publicationTable" class="table table-striped table-hover">
            <thead>
                <th>Publication</th>
                <th>Actions</th>
            </thead>
            <tbody>
            {% for item in publicationList %}
            <tr id="{{ item._id }}">
                <td>{{ item.publication|safe }}</td>
                <td width="150">
                    <button type="button" title="Edit" class="btn btn-default" onclick="alert('I don\'t work yet!');">
                        <span class="glyphicon glyphicon-pencil"></span>
                    </button>
                    <button type="button" title="Delete" class="btn btn-default" id="delete">
                        <span class="glyphicon glyphicon-trash"></span>
                    </button>
                    <button type="button" title="Export Manifest" class="btn btn-default" id="export">
                        <span class="glyphicon glyphicon-download"></span>
                    </button>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
    </div>

{% endblock %}


{% block scripts %}
    <script>
        $(document).ready(function () {
            $("#help").click(function () {
                html = '<p>Publications contains a list of all publications in the database. .';
                $('#myModal .modal-title').html("<h3>Publications Help</h3>");
                $('#myModal .modal-body').html(html);
                $('#myModal').modal();
            });
        });
    </script>
{% endblock %}